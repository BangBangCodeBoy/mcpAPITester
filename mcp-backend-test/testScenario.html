<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>API í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</title>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <style>
            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .container {
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            h1 {
                color: #333;
                border-bottom: 3px solid #4caf50;
                padding-bottom: 10px;
            }
            .test-section {
                margin: 20px 0;
                padding: 15px;
                background: #f9f9f9;
                border-left: 4px solid #2196f3;
                border-radius: 5px;
            }
            .test-section h2 {
                margin-top: 0;
                color: #2196f3;
            }
            button {
                background-color: #4caf50;
                color: white;
                padding: 12px 24px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                margin: 10px 5px;
            }
            button:hover {
                background-color: #45a049;
            }
            button:disabled {
                background-color: #cccccc;
                cursor: not-allowed;
            }
            .status {
                display: inline-block;
                padding: 5px 10px;
                border-radius: 3px;
                font-weight: bold;
                margin-left: 10px;
            }
            .status.success {
                background-color: #4caf50;
                color: white;
            }
            .status.error {
                background-color: #f44336;
                color: white;
            }
            .status.pending {
                background-color: #ff9800;
                color: white;
            }
            #console-output {
                background: #1e1e1e;
                color: #d4d4d4;
                padding: 20px;
                border-radius: 5px;
                font-family: "Courier New", monospace;
                font-size: 12px;
                max-height: 500px;
                overflow-y: auto;
                margin-top: 20px;
                white-space: pre-wrap;
                word-wrap: break-word;
            }
            .log-item {
                margin: 5px 0;
                padding: 5px;
                border-left: 3px solid #4caf50;
                padding-left: 10px;
            }
            .log-item.error {
                border-left-color: #f44336;
            }
            .log-item.info {
                border-left-color: #2196f3;
            }
            .login-section {
                background: #e3f2fd;
                border-left: 4px solid #2196f3;
            }
            input[type="text"],
            input[type="password"] {
                padding: 10px;
                margin: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 14px;
                width: 200px;
            }
            .login-info {
                margin-top: 10px;
                padding: 10px;
                background: #fff3cd;
                border-radius: 5px;
                font-size: 14px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ğŸš€ API í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h1>
            <p>ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ ì—´ì–´ì„œ ìƒì„¸í•œ JSON ì‘ë‹µì„ í™•ì¸í•˜ì„¸ìš”.</p>

            <div class="test-section login-section">
                <h2>ğŸ” ë¡œê·¸ì¸</h2>
                <div>
                    <input
                        type="text"
                        id="loginId"
                        placeholder="ì•„ì´ë””"
                        value=""
                    />
                    <input
                        type="password"
                        id="loginPassword"
                        placeholder="ë¹„ë°€ë²ˆí˜¸"
                        value=""
                    />
                    <button onclick="manualLogin()">ë¡œê·¸ì¸</button>
                    <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
                <div id="loginStatus" class="login-info">
                    ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                </div>
            </div>

            <div class="test-section">
                <h2>í…ŒìŠ¤íŠ¸ ì œì–´</h2>
                <button id="startTest" onclick="startTest()">
                    ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘
                </button>
                <button id="stopTest" onclick="stopTest()" disabled>
                    í…ŒìŠ¤íŠ¸ ì¤‘ì§€
                </button>
                <button onclick="clearConsole()">ì½˜ì†” ì§€ìš°ê¸°</button>
                <button onclick="checkSession()">ì„¸ì…˜ í™•ì¸</button>
                <button onclick="checkCookies()">ì¿ í‚¤ í™•ì¸</button>
            </div>

            <div class="test-section">
                <h2>í…ŒìŠ¤íŠ¸ ì§„í–‰ ìƒí™©</h2>
                <div id="testStatus">ëŒ€ê¸° ì¤‘...</div>
            </div>

            <div class="test-section">
                <h2>ì½˜ì†” ì¶œë ¥</h2>
                <div id="console-output"></div>
            </div>
        </div>

        <script>
            // Vite í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ìƒëŒ€ ê²½ë¡œë¡œ ë³€ê²½
            // Vite ê°œë°œ ì„œë²„ê°€ /apië¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì„ http://localhost:8080ìœ¼ë¡œ í”„ë¡ì‹œ
            // Vite í”„ë¡ì‹œ ì‚¬ìš©: /apië¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì´ http://localhost:8080ìœ¼ë¡œ í”„ë¡ì‹œë¨
            const BACKEND_BASE_URL = "";
            let testResults = [];
            let isTestRunning = false;
            let loggedInMemberId = null;
            let userProblemSetId = null;
            let userProblemIds = [];
            let commentIds = [];
            let quizRoomId = null;
            let incorrectNoteId = null;
            let signupId = "";
            let signupPassword = "";

            // axios ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (withCredentials ê°•ì œ ì„¤ì •)
            const axiosInstance = axios.create({
                withCredentials: true,
                headers: {
                    "Content-Type": "application/json",
                },
            });

            // axios ê¸°ë³¸ ì„¤ì •ë„ í•¨ê»˜ ì„¤ì •
            axios.defaults.withCredentials = true;

            // ìš”ì²­ ì¸í„°ì…‰í„°: ëª¨ë“  ìš”ì²­ì— ì¿ í‚¤ í¬í•¨ í™•ì¸
            axiosInstance.interceptors.request.use(
                (config) => {
                    config.withCredentials = true;
                    // ì¿ í‚¤ê°€ ìˆëŠ”ì§€ í™•ì¸
                    const cookies = document.cookie;
                    if (cookies) {
                        console.log("ìš”ì²­ ì „ ì¿ í‚¤:", cookies);
                    }
                    return config;
                },
                (error) => {
                    return Promise.reject(error);
                }
            );

            // ì‘ë‹µ ì¸í„°ì…‰í„°: Set-Cookie í—¤ë” í™•ì¸ ë° ì¿ í‚¤ ì €ì¥ ê°•ì œ
            axiosInstance.interceptors.response.use(
                (response) => {
                    // Set-Cookie í—¤ë” í™•ì¸
                    const setCookie = response.headers["set-cookie"];
                    const setCookieHeader =
                        response.headers["set-cookie"] ||
                        response.headers["Set-Cookie"];

                    if (setCookie || setCookieHeader) {
                        const cookieValue = setCookie || setCookieHeader;
                        console.log("ì„œë²„ì—ì„œ ì¿ í‚¤ ì„¤ì •:", cookieValue);
                        log(
                            `ì„œë²„ì—ì„œ ì¿ í‚¤ ì„¤ì •ë¨: ${JSON.stringify(
                                cookieValue
                            )}`,
                            "info"
                        );

                        // ì¿ í‚¤ë¥¼ ìˆ˜ë™ìœ¼ë¡œ íŒŒì‹±í•˜ì—¬ ì €ì¥ ì‹œë„
                        if (Array.isArray(cookieValue)) {
                            cookieValue.forEach((cookie) => {
                                const cookieParts = cookie
                                    .split(";")[0]
                                    .split("=");
                                if (cookieParts.length === 2) {
                                    const cookieName = cookieParts[0].trim();
                                    const cookieVal = cookieParts[1].trim();
                                    // document.cookieì— ì§ì ‘ ì„¤ì • ì‹œë„
                                    document.cookie = `${cookieName}=${cookieVal}; path=/; SameSite=Lax`;
                                    log(
                                        `ì¿ í‚¤ ìˆ˜ë™ ì €ì¥ ì‹œë„: ${cookieName}=${cookieVal}`,
                                        "info"
                                    );
                                }
                            });
                        } else if (typeof cookieValue === "string") {
                            const cookieParts = cookieValue
                                .split(";")[0]
                                .split("=");
                            if (cookieParts.length === 2) {
                                const cookieName = cookieParts[0].trim();
                                const cookieVal = cookieParts[1].trim();
                                document.cookie = `${cookieName}=${cookieVal}; path=/; SameSite=Lax`;
                                log(
                                    `ì¿ í‚¤ ìˆ˜ë™ ì €ì¥ ì‹œë„: ${cookieName}=${cookieVal}`,
                                    "info"
                                );
                            }
                        }

                        // ì €ì¥ í›„ ì¿ í‚¤ í™•ì¸
                        setTimeout(() => {
                            const savedCookies = document.cookie;
                            log(
                                `ì €ì¥ í›„ ì¿ í‚¤ í™•ì¸: ${
                                    savedCookies || "(ì—†ìŒ)"
                                }`,
                                "info"
                            );
                            console.log("ì €ì¥ í›„ ì¿ í‚¤:", savedCookies);
                        }, 100);
                    } else {
                        log("âš ï¸ Set-Cookie í—¤ë”ê°€ ì‘ë‹µì— ì—†ìŠµë‹ˆë‹¤.", "error");
                        console.warn(
                            "Set-Cookie í—¤ë” ì—†ìŒ. ì‘ë‹µ í—¤ë”:",
                            response.headers
                        );
                    }
                    return response;
                },
                (error) => {
                    return Promise.reject(error);
                }
            );

            // ì¿ í‚¤ í™•ì¸ í•¨ìˆ˜ (ìƒì„¸ ì •ë³´ í¬í•¨)
            function checkCookies() {
                const cookies = document.cookie;
                log(`í˜„ì¬ ì¿ í‚¤: ${cookies || "(ì—†ìŒ)"}`, "info");
                console.log("í˜„ì¬ ì¿ í‚¤:", cookies);

                // ì¿ í‚¤ê°€ ì—†ìœ¼ë©´ ì›ì¸ ë¶„ì„
                if (!cookies) {
                    log("âš ï¸ ì¿ í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤. ê°€ëŠ¥í•œ ì›ì¸:", "error");
                    log("  1. ì„œë²„ê°€ Set-Cookie í—¤ë”ë¥¼ ë³´ë‚´ì§€ ì•ŠìŒ", "error");
                    log(
                        "  2. CORS ì„¤ì • ë¬¸ì œ (Access-Control-Allow-Credentials)",
                        "error"
                    );
                    log(
                        "  3. ë¸Œë¼ìš°ì € ì¿ í‚¤ ì •ì±… (SameSite, Secure ë“±)",
                        "error"
                    );
                    log("  4. ë„ë©”ì¸/í¬íŠ¸ ë¶ˆì¼ì¹˜", "error");
                    log(`  5. í˜„ì¬ URL: ${window.location.href}`, "error");
                    log(
                        `  6. Vite í”„ë¡ì‹œ ì‚¬ìš©: /api ìš”ì²­ì´ http://localhost:8080ìœ¼ë¡œ í”„ë¡ì‹œë¨`,
                        "error"
                    );
                } else {
                    // ì¿ í‚¤ íŒŒì‹±
                    const cookieArray = cookies.split(";").map((c) => c.trim());
                    log(
                        `ì´ ${cookieArray.length}ê°œì˜ ì¿ í‚¤ê°€ ìˆìŠµë‹ˆë‹¤:`,
                        "info"
                    );
                    cookieArray.forEach((cookie, index) => {
                        const [name, value] = cookie.split("=");
                        log(
                            `  ${index + 1}. ${name} = ${value || "(ê°’ ì—†ìŒ)"}`,
                            "info"
                        );
                    });
                }

                return cookies;
            }

            // ì„¸ì…˜ í™•ì¸ í•¨ìˆ˜
            async function checkSession() {
                try {
                    log("\n=== ì„¸ì…˜ í™•ì¸ ===", "info");
                    const cookies = document.cookie;
                    log(`í˜„ì¬ ì¿ í‚¤: ${cookies || "(ì—†ìŒ)"}`, "info");

                    const response = await axiosInstance.get(
                        `/api/user-problem-sets/me`
                    );
                    log("âœ… ì„¸ì…˜ì´ ìœ íš¨í•©ë‹ˆë‹¤.", "info");
                    console.log("ì„¸ì…˜ í™•ì¸ ì‘ë‹µ:", response.data);
                    return true;
                } catch (error) {
                    if (
                        error.response?.status === 401 ||
                        error.response?.status === 404
                    ) {
                        log(
                            "âŒ ì„¸ì…˜ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤)",
                            "error"
                        );
                        console.error("ì„¸ì…˜ í™•ì¸ ì‹¤íŒ¨:", error.response?.data);
                        return false;
                    }
                    log(`ì„¸ì…˜ í™•ì¸ ì¤‘ ì˜¤ë¥˜: ${error.message}`, "error");
                    return false;
                }
            }

            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
            function updateLoginStatus() {
                const loginStatus = document.getElementById("loginStatus");
                if (loggedInMemberId) {
                    loginStatus.innerHTML = `âœ… ë¡œê·¸ì¸ë¨ - íšŒì› ID: ${loggedInMemberId} (ì•„ì´ë””: ${
                        signupId || "N/A"
                    })`;
                    loginStatus.style.background = "#d4edda";
                } else {
                    loginStatus.innerHTML = "âŒ ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
                    loginStatus.style.background = "#fff3cd";
                }
            }

            // ìˆ˜ë™ ë¡œê·¸ì¸
            async function manualLogin() {
                const id = document.getElementById("loginId").value;
                const password = document.getElementById("loginPassword").value;

                if (!id || !password) {
                    alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                    return;
                }

                try {
                    log(`\n=== ìˆ˜ë™ ë¡œê·¸ì¸ ì‹œë„ ===`, "info");
                    log(`ì•„ì´ë””: ${id}`, "info");

                    // ë¡œê·¸ì¸ ì „ ì¿ í‚¤ í™•ì¸
                    log("ë¡œê·¸ì¸ ì „ ì¿ í‚¤:", "info");
                    checkCookies();

                    // ë¡œê·¸ì¸ ìš”ì²­: idì™€ passwordë¥¼ ë³´ëƒ„ (ì„œë²„ê°€ member_idë¥¼ ì°¾ì•„ì„œ ì„¸ì…˜ì— ì €ì¥)
                    // Vite í”„ë¡ì‹œë¥¼ í†µí•´ /api/auth/loginì´ http://localhost:8080/api/auth/loginìœ¼ë¡œ ì „ë‹¬ë¨
                    const response = await axiosInstance.post(
                        `/api/auth/login`,
                        {
                            id: id, // ì‚¬ìš©ì ì•„ì´ë”” (ì˜ˆ: "2")
                            password: password, // ë¹„ë°€ë²ˆí˜¸ (ì˜ˆ: "1234")
                        }
                    );

                    // ì„œë²„ ì‘ë‹µ í™•ì¸
                    console.log("ë¡œê·¸ì¸ ì‘ë‹µ ì „ì²´:", response.data);
                    console.log("ì‘ë‹µ í—¤ë”:", response.headers);
                    log("ì„œë²„ ì‘ë‹µ ë°ì´í„°:", "info");
                    log(JSON.stringify(response.data, null, 2), "info");

                    // ì„œë²„ê°€ ë³´ë‚¸ ë°ì´í„° í™•ì¸: id, password, memberId
                    const responseData = response.data?.data;
                    if (responseData) {
                        log(`ì„œë²„ ì‘ë‹µì—ì„œ ë°›ì€ ë°ì´í„°:`, "info");
                        log(`  - id: ${responseData.id || "(ì—†ìŒ)"}`, "info");
                        log(
                            `  - password: ${
                                responseData.password ? "***" : "(ì—†ìŒ)"
                            }`,
                            "info"
                        );
                        log(
                            `  - memberId: ${
                                responseData.memberId || "(ì—†ìŒ)"
                            }`,
                            "info"
                        );
                        log(
                            `  - nickname: ${
                                responseData.nickname || "(ì—†ìŒ)"
                            }`,
                            "info"
                        );
                    }

                    // ë¡œê·¸ì¸ í›„ ì¿ í‚¤ í™•ì¸ (ì•½ê°„ì˜ ì§€ì—° í›„)
                    setTimeout(() => {
                        log("ë¡œê·¸ì¸ í›„ ì¿ í‚¤ í™•ì¸ (100ms í›„):", "info");
                        checkCookies();
                    }, 100);

                    if (responseData?.memberId) {
                        loggedInMemberId = responseData.memberId;
                        signupId = responseData.id || id; // ì„œë²„ì—ì„œ ë³´ë‚¸ id ì‚¬ìš©
                        signupPassword = password; // passwordëŠ” ë³´ì•ˆìƒ ì €ì¥í•˜ì§€ ì•Šì§€ë§Œ ë³€ìˆ˜ëŠ” ìœ ì§€

                        log(
                            `âœ… ë¡œê·¸ì¸ ì„±ê³µ! íšŒì› ID: ${loggedInMemberId} (DBì˜ member_id)`,
                            "info"
                        );
                        log(
                            `ì„œë²„ ì‘ë‹µ: id=${signupId}, memberId=${loggedInMemberId}`,
                            "info"
                        );
                        log(
                            `ì„œë²„ê°€ ì„¸ì…˜ì— memberId=${loggedInMemberId} ì €ì¥ ì™„ë£Œ (ì„œë²„ ì¸¡ì—ì„œ ì²˜ë¦¬)`,
                            "info"
                        );

                        // ì„¸ì…˜ í™•ì¸: ì„œë²„ê°€ ì„¸ì…˜ì— memberIdë¥¼ ì œëŒ€ë¡œ ì €ì¥í–ˆëŠ”ì§€ í™•ì¸
                        log("\n=== ì„¸ì…˜ ì €ì¥ í™•ì¸ ===", "info");
                        log(
                            `ì„œë²„ê°€ ì‘ë‹µìœ¼ë¡œ ë³´ë‚¸ memberId: ${loggedInMemberId}`,
                            "info"
                        );
                        log(
                            `ì´ memberIdê°€ ì„œë²„ ì„¸ì…˜ì— ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸ ì¤‘...`,
                            "info"
                        );

                        const sessionCheckResult = await checkSession();
                        if (sessionCheckResult) {
                            log(
                                `âœ… ì„¸ì…˜ì— memberId=${loggedInMemberId}ê°€ ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`,
                                "info"
                            );
                            log(
                                `ì„œë²„ê°€ ì„¸ì…˜ì—ì„œ memberIdë¥¼ ì½ì–´ì„œ ì¸ì¦ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                                "info"
                            );
                        } else {
                            log(
                                `âš ï¸ ì„¸ì…˜ í™•ì¸ ì‹¤íŒ¨. ì„œë²„ê°€ ì„¸ì…˜ì— memberIdë¥¼ ì €ì¥í•˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                                "error"
                            );
                            log(
                                `ì„œë²„ ì‘ë‹µì˜ memberId=${loggedInMemberId}ëŠ” ë°›ì•˜ì§€ë§Œ, ì„¸ì…˜ ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                                "error"
                            );
                        }

                        updateLoginStatus();
                        alert("ë¡œê·¸ì¸ ì„±ê³µ!");
                    } else {
                        throw new Error(
                            "ë¡œê·¸ì¸ ì‹¤íŒ¨: memberIdë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
                        );
                    }
                } catch (error) {
                    log(
                        `âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ${
                            error.response?.data?.message || error.message
                        }`,
                        "error"
                    );
                    console.error(
                        "ë¡œê·¸ì¸ ì—ëŸ¬:",
                        error.response?.data || error.message
                    );
                    console.error("ì—ëŸ¬ ì‘ë‹µ í—¤ë”:", error.response?.headers);
                    alert(
                        "ë¡œê·¸ì¸ ì‹¤íŒ¨: " +
                            (error.response?.data?.message || error.message)
                    );
                }
            }

            // ë¡œê·¸ì•„ì›ƒ
            async function logout() {
                try {
                    await axiosInstance.post(`/api/auth/logout`, {});
                    loggedInMemberId = null;
                    signupId = "";
                    signupPassword = "";
                    log("ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ", "info");
                    updateLoginStatus();
                    alert("ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!");
                } catch (error) {
                    log(`ë¡œê·¸ì•„ì›ƒ ì—ëŸ¬: ${error.message}`, "error");
                }
            }

            function log(message, type = "info") {
                const consoleOutput = document.getElementById("console-output");
                const timestamp = new Date().toLocaleTimeString();
                const logItem = document.createElement("div");
                logItem.className = `log-item ${type}`;
                logItem.textContent = `[${timestamp}] ${message}`;
                consoleOutput.appendChild(logItem);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;

                // ë¸Œë¼ìš°ì € ì½˜ì†”ì—ë„ ì¶œë ¥
                if (type === "error") {
                    console.error(message);
                } else if (type === "info") {
                    console.info(message);
                } else {
                    console.log(message);
                }
            }

            function clearConsole() {
                document.getElementById("console-output").innerHTML = "";
                console.clear();
            }

            function updateStatus(message, status = "pending") {
                const statusDiv = document.getElementById("testStatus");
                statusDiv.innerHTML = `<span class="status ${status}">${message}</span>`;
            }

            async function testAPI(step, name, method, url, data = null) {
                try {
                    log(`\n[${step}] ${name} - ${method} ${url}`, "info");
                    if (data) {
                        log(
                            `ìš”ì²­ ë°ì´í„°: ${JSON.stringify(data, null, 2)}`,
                            "info"
                        );
                        console.log(`[${step}] ${name} - ìš”ì²­ ë°ì´í„°:`, data);
                    }

                    // ì¿ í‚¤ í™•ì¸ (ë””ë²„ê¹…ìš©)
                    if (step === 3 || step === 4) {
                        // ë¡œê·¸ì¸ ì§í›„ë‚˜ ì²« ë²ˆì§¸ API í˜¸ì¶œ ì‹œ
                        const cookies = document.cookie;
                        log(`ìš”ì²­ ì „ ì¿ í‚¤: ${cookies || "(ì—†ìŒ)"}`, "info");
                        console.log(`[${step}] ìš”ì²­ ì „ ì¿ í‚¤:`, cookies);
                    }

                    // axiosInstance ì‚¬ìš© (withCredentials ìë™ í¬í•¨)
                    // Vite í”„ë¡ì‹œë¥¼ í†µí•´ /apië¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì´ ìë™ìœ¼ë¡œ http://localhost:8080ìœ¼ë¡œ ì „ë‹¬ë¨
                    const config = {
                        method: method.toLowerCase(),
                        url: url, // urlì´ ì´ë¯¸ /apië¡œ ì‹œì‘í•˜ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
                    };

                    if (data) {
                        config.data = data;
                    }

                    const response = await axiosInstance(config);

                    // ì‘ë‹µ í—¤ë”ì—ì„œ Set-Cookie í™•ì¸
                    if (response.headers["set-cookie"]) {
                        log(
                            `ì„œë²„ì—ì„œ ì¿ í‚¤ ì„¤ì •: ${JSON.stringify(
                                response.headers["set-cookie"]
                            )}`,
                            "info"
                        );
                        console.log(
                            `[${step}] Set-Cookie í—¤ë”:`,
                            response.headers["set-cookie"]
                        );
                    }

                    const result = {
                        step,
                        name,
                        method,
                        url,
                        status: response.status,
                        success:
                            response.status >= 200 && response.status < 300,
                        response: response.data,
                    };

                    log(`âœ… ì„±ê³µ (${response.status})`, "info");
                    log(
                        `ì‘ë‹µ: ${JSON.stringify(response.data, null, 2)}`,
                        "info"
                    );
                    console.log(`[${step}] ${name} - ì‘ë‹µ:`, response.data);

                    testResults.push(result);
                    return result;
                } catch (error) {
                    const result = {
                        step,
                        name,
                        method,
                        url,
                        status: error.response?.status || null,
                        success: false,
                        error: error.response?.data || error.message,
                    };

                    log(`âŒ ì‹¤íŒ¨ (${result.status || "N/A"})`, "error");
                    log(
                        `ì—ëŸ¬: ${JSON.stringify(result.error, null, 2)}`,
                        "error"
                    );
                    console.error(`[${step}] ${name} - ì—ëŸ¬:`, result.error);

                    testResults.push(result);
                    return result;
                }
            }

            // DB ì´ˆê¸°í™” (ëª¨ë“  í…Œì´ë¸” ë°ì´í„° ì‚­ì œ)
            async function resetDatabase() {
                log("\n=== [1] ëª¨ë“  í…Œì´ë¸”ì˜ ë°ì´í„° ì‚­ì œ ===", "info");
                log("âš ï¸  ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì§ì ‘ DB ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.", "info");
                log(
                    "DB ì´ˆê¸°í™”ëŠ” ì„œë²„ ì¸¡ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜í–‰í•˜ê±°ë‚˜, API ì—”ë“œí¬ì¸íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
                    "info"
                );

                // ë§Œì•½ DB ì´ˆê¸°í™” APIê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì„œ í˜¸ì¶œ
                // ì˜ˆ: await testAPI(1, 'DB ì´ˆê¸°í™”', 'POST', '/api/admin/reset-database');

                log(
                    "DB ì´ˆê¸°í™”ëŠ” ìŠ¤í‚µë©ë‹ˆë‹¤. (ìˆ˜ë™ìœ¼ë¡œ DBë¥¼ ì´ˆê¸°í™”í•˜ê±°ë‚˜ API ì—”ë“œí¬ì¸íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤)",
                    "info"
                );
                return true;
            }

            async function startTest() {
                if (isTestRunning) return;

                // ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©, ì•„ë‹ˆë©´ ìƒˆë¡œ íšŒì›ê°€ì… í›„ ë¡œê·¸ì¸
                const useExistingLogin = loggedInMemberId !== null;

                isTestRunning = true;
                document.getElementById("startTest").disabled = true;
                document.getElementById("stopTest").disabled = false;
                testResults = [];
                clearConsole();

                log("ğŸš€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘", "info");
                updateStatus("í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...", "pending");

                try {
                    // 1. DB ì´ˆê¸°í™” (ëª¨ë“  í…Œì´ë¸” ë°ì´í„° ì‚­ì œ)
                    await resetDatabase();

                    if (!useExistingLogin) {
                        // 2. íšŒì›ê°€ì…
                        log("\n=== [2] íšŒì›ê°€ì… + ì ìˆ˜ ë“±ë¡ ===", "info");
                        const timeSuffix = Date.now().toString().slice(-6);
                        signupId = `test${timeSuffix}`;
                        signupPassword = "testpass123";

                        const signupResult = await testAPI(
                            2,
                            "íšŒì›ê°€ì…",
                            "POST",
                            "/api/member",
                            {
                                id: signupId,
                                password: signupPassword,
                                nickname: "í…ŒìŠ¤íŠ¸ìœ ì €",
                                email: `test${timeSuffix}@test.com`,
                            }
                        );

                        if (!signupResult.success) {
                            throw new Error("íšŒì›ê°€ì… ì‹¤íŒ¨");
                        }

                        // 3. ë¡œê·¸ì¸
                        log("\n=== [3] ë¡œê·¸ì¸ ===", "info");
                        log(
                            `ë¡œê·¸ì¸ ìš”ì²­: id=${signupId}, password=${signupPassword}`,
                            "info"
                        );
                        const loginResult = await testAPI(
                            3,
                            "ë¡œê·¸ì¸",
                            "POST",
                            "/api/auth/login",
                            {
                                id: signupId, // ì‚¬ìš©ì ì•„ì´ë””
                                password: signupPassword, // ë¹„ë°€ë²ˆí˜¸
                            }
                        );

                        // ì„œë²„ ì‘ë‹µ í™•ì¸
                        const loginResponseData = loginResult.response?.data;
                        if (loginResponseData) {
                            log(`ì„œë²„ ì‘ë‹µì—ì„œ ë°›ì€ ë°ì´í„°:`, "info");
                            log(
                                `  - id: ${loginResponseData.id || "(ì—†ìŒ)"}`,
                                "info"
                            );
                            log(
                                `  - memberId: ${
                                    loginResponseData.memberId || "(ì—†ìŒ)"
                                }`,
                                "info"
                            );
                            log(
                                `  - nickname: ${
                                    loginResponseData.nickname || "(ì—†ìŒ)"
                                }`,
                                "info"
                            );
                        }

                        if (
                            loginResult.success &&
                            loginResponseData?.memberId
                        ) {
                            loggedInMemberId = loginResponseData.memberId;
                            signupId = loginResponseData.id || signupId; // ì„œë²„ì—ì„œ ë³´ë‚¸ id ì‚¬ìš©

                            log(
                                `âœ… ë¡œê·¸ì¸ ì„±ê³µ! íšŒì› ID: ${loggedInMemberId} (DBì˜ member_id)`,
                                "info"
                            );
                            log(
                                `ì„œë²„ ì‘ë‹µ: id=${signupId}, memberId=${loggedInMemberId}`,
                                "info"
                            );
                            log(
                                `ì„œë²„ê°€ ì„¸ì…˜ì— memberId=${loggedInMemberId} ì €ì¥ ì™„ë£Œ (ì„œë²„ ì¸¡ì—ì„œ ì²˜ë¦¬)`,
                                "info"
                            );

                            // ì„¸ì…˜ ì €ì¥ í™•ì¸
                            log("\n=== ì„¸ì…˜ ì €ì¥ í™•ì¸ ===", "info");
                            const sessionCheckResult = await checkSession();
                            if (sessionCheckResult) {
                                log(
                                    `âœ… ì„¸ì…˜ì— memberId=${loggedInMemberId}ê°€ ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`,
                                    "info"
                                );
                            } else {
                                log(
                                    `âš ï¸ ì„¸ì…˜ í™•ì¸ ì‹¤íŒ¨. ì„œë²„ê°€ ì„¸ì…˜ì— memberIdë¥¼ ì €ì¥í•˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                                    "error"
                                );
                            }

                            updateLoginStatus();
                        } else {
                            throw new Error("ë¡œê·¸ì¸ ì‹¤íŒ¨");
                        }
                    } else {
                        log("\n=== ê¸°ì¡´ ë¡œê·¸ì¸ ì„¸ì…˜ ì‚¬ìš© ===", "info");
                        log(
                            `ì´ë¯¸ ë¡œê·¸ì¸ëœ íšŒì› ID: ${loggedInMemberId}`,
                            "info"
                        );
                    }

                    // 2-2. ì ìˆ˜ ë“±ë¡
                    log("\n=== [2-2] ì ìˆ˜ ë“±ë¡ ===", "info");
                    await testAPI(2, "ì ìˆ˜ ë“±ë¡", "POST", "/api/scores", {
                        score: 100,
                    });

                    // 4. ë¬¸ì œì„¸íŠ¸ ì „ì²´ì¡°íšŒ
                    log("\n=== [4] ë¬¸ì œì„¸íŠ¸ ì „ì²´ì¡°íšŒ ===", "info");
                    await testAPI(
                        4,
                        "ë¬¸ì œì„¸íŠ¸ ì „ì²´ì¡°íšŒ",
                        "GET",
                        "/api/user-problem-sets"
                    );

                    // 5. ë‚´ ë¬¸ì œì„¸íŠ¸ ì¡°íšŒ
                    log("\n=== [5] ë‚´ ë¬¸ì œì„¸íŠ¸ ì¡°íšŒ ===", "info");
                    const mySetResult = await testAPI(
                        5,
                        "ë‚´ ë¬¸ì œì„¸íŠ¸ ì¡°íšŒ",
                        "GET",
                        "/api/user-problem-sets/me"
                    );

                    if (
                        mySetResult.success &&
                        mySetResult.response?.data?.userProblemSetId
                    ) {
                        userProblemSetId =
                            mySetResult.response.data.userProblemSetId;
                        log(`ë¬¸ì œì„¸íŠ¸ ID: ${userProblemSetId}`, "info");
                    } else {
                        log("ë¬¸ì œì„¸íŠ¸ê°€ ì—†ì–´ì„œ ìƒì„±í•©ë‹ˆë‹¤.", "info");
                        const createSetResult = await testAPI(
                            5,
                            "ë¬¸ì œì„¸íŠ¸ ìƒì„±",
                            "POST",
                            "/api/user-problem-sets"
                        );
                        if (createSetResult.success) {
                            const recheckResult = await testAPI(
                                5,
                                "ë‚´ ë¬¸ì œì„¸íŠ¸ ì¬ì¡°íšŒ",
                                "GET",
                                "/api/user-problem-sets/me"
                            );
                            if (
                                recheckResult.success &&
                                recheckResult.response?.data?.userProblemSetId
                            ) {
                                userProblemSetId =
                                    recheckResult.response.data
                                        .userProblemSetId;
                                log(
                                    `ìƒì„±ëœ ë¬¸ì œì„¸íŠ¸ ID: ${userProblemSetId}`,
                                    "info"
                                );
                            }
                        }
                    }

                    // 6. ìœ ì €ì œì‘ë¬¸ì œ 3ê°œ ì¶”ê°€
                    log("\n=== [6] ìœ ì €ì œì‘ë¬¸ì œ 3ê°œ ì¶”ê°€ ===", "info");
                    if (userProblemSetId) {
                        await testAPI(
                            6,
                            "ë¬¸ì œ ì¼ê´„ ë“±ë¡",
                            "POST",
                            `/api/user-problems/sets/${userProblemSetId}`,
                            [
                                {
                                    problemDescription:
                                        "ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ë¬¸ì œ 1",
                                    category: "INFOENGINEERING",
                                    choice1: "ì„ íƒì§€1",
                                    choice2: "ì„ íƒì§€2",
                                    choice3: "ì„ íƒì§€3",
                                    choice4: "ì„ íƒì§€4",
                                    answer: "1",
                                },
                                {
                                    problemDescription:
                                        "ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ë¬¸ì œ 2",
                                    category: "INFOENGINEERING",
                                    choice1: "ì„ íƒì§€A",
                                    choice2: "ì„ íƒì§€B",
                                    choice3: "ì„ íƒì§€C",
                                    choice4: "ì„ íƒì§€D",
                                    answer: "2",
                                },
                                {
                                    problemDescription:
                                        "ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ë¬¸ì œ 3",
                                    category: "SQLD",
                                    choice1: "ì˜µì…˜1",
                                    choice2: "ì˜µì…˜2",
                                    choice3: "ì˜µì…˜3",
                                    choice4: "ì˜µì…˜4",
                                    answer: "3",
                                },
                            ]
                        );

                        const getProblemsResult = await testAPI(
                            6,
                            "ë¬¸ì œ ëª©ë¡ ì¡°íšŒ",
                            "GET",
                            `/api/user-problems/sets/${userProblemSetId}`
                        );
                        if (
                            getProblemsResult.success &&
                            getProblemsResult.response?.data
                        ) {
                            userProblemIds = getProblemsResult.response.data
                                .map((p) => p.userProblemId)
                                .filter((id) => id !== undefined);
                            log(
                                `ë“±ë¡ëœ ë¬¸ì œ ID: ${userProblemIds.join(", ")}`,
                                "info"
                            );
                        }
                    }

                    // 7. ìœ ì €ì œì‘ë¬¸ì œ ìˆ˜ì •
                    log("\n=== [7] ìœ ì €ì œì‘ë¬¸ì œ ìˆ˜ì • ===", "info");
                    if (userProblemIds.length > 0) {
                        await testAPI(
                            7,
                            "ë¬¸ì œ ìˆ˜ì •",
                            "PUT",
                            `/api/user-problems/${userProblemIds[0]}`,
                            {
                                problemDescription: "ìˆ˜ì •ëœ ë¬¸ì œì…ë‹ˆë‹¤!",
                                category: "INFOENGINEERING",
                                choice1: "ìˆ˜ì •1",
                                choice2: "ìˆ˜ì •2",
                                choice3: "ìˆ˜ì •3",
                                choice4: "ìˆ˜ì •4",
                                answer: "2",
                            }
                        );
                    }

                    // 8. ëŒ“ê¸€ ì¡°íšŒ
                    log("\n=== [8] ëŒ“ê¸€ ì¡°íšŒ ===", "info");
                    if (userProblemSetId) {
                        const getCommentsResult = await testAPI(
                            8,
                            "ëŒ“ê¸€ ì¡°íšŒ",
                            "GET",
                            `/api/comments/${userProblemSetId}`
                        );
                        if (
                            getCommentsResult.success &&
                            getCommentsResult.response?.data
                        ) {
                            commentIds = getCommentsResult.response.data
                                .map((c) => c.commentId)
                                .filter((id) => id !== undefined);
                        }
                    }

                    // 9. ëŒ“ê¸€ 3ê°œ ì‘ì„±
                    log("\n=== [9] ëŒ“ê¸€ 3ê°œ ì‘ì„± ===", "info");
                    if (userProblemSetId) {
                        for (let i = 1; i <= 3; i++) {
                            await testAPI(
                                9,
                                `ëŒ“ê¸€ ì‘ì„± ${i}`,
                                "POST",
                                `/api/comments/${userProblemSetId}`,
                                {
                                    content: `ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ëŒ“ê¸€ ${i}ì…ë‹ˆë‹¤.`,
                                }
                            );
                        }

                        const recheckComments = await testAPI(
                            9,
                            "ëŒ“ê¸€ ì¬ì¡°íšŒ",
                            "GET",
                            `/api/comments/${userProblemSetId}`
                        );
                        if (
                            recheckComments.success &&
                            recheckComments.response?.data
                        ) {
                            commentIds = recheckComments.response.data
                                .map((c) => c.commentId)
                                .filter((id) => id !== undefined);
                        }
                    }

                    // 10. ëŒ“ê¸€ ìˆ˜ì •
                    log("\n=== [10] ëŒ“ê¸€ ìˆ˜ì • ===", "info");
                    if (userProblemSetId && commentIds.length > 0) {
                        await testAPI(
                            10,
                            "ëŒ“ê¸€ ìˆ˜ì •",
                            "PATCH",
                            `/api/comments/${userProblemSetId}/${commentIds[0]}`,
                            {
                                content: "ìˆ˜ì •ëœ ëŒ“ê¸€ ë‚´ìš©ì…ë‹ˆë‹¤!",
                            }
                        );
                    }

                    // 11. ëŒ“ê¸€ ì‚­ì œ
                    log("\n=== [11] ëŒ“ê¸€ ì‚­ì œ ===", "info");
                    if (userProblemSetId && commentIds.length > 1) {
                        await testAPI(
                            11,
                            "ëŒ“ê¸€ ì‚­ì œ",
                            "DELETE",
                            `/api/comments/${userProblemSetId}/${commentIds[1]}`
                        );
                    }

                    // 13. ëª¨ë“  íšŒì›ë“¤ì˜ ì ìˆ˜ ì¡°íšŒ
                    log("\n=== [13] ëª¨ë“  íšŒì›ë“¤ì˜ ì ìˆ˜ ì¡°íšŒ ===", "info");
                    await testAPI(13, "ì „ì²´ ì ìˆ˜ ì¡°íšŒ", "GET", "/api/scores");

                    // 14. íŠ¹ì • íšŒì› ì ìˆ˜ ì¡°íšŒ
                    log("\n=== [14] íŠ¹ì • íšŒì› ì ìˆ˜ ì¡°íšŒ ===", "info");
                    if (loggedInMemberId) {
                        await testAPI(
                            14,
                            "íŠ¹ì • íšŒì› ì ìˆ˜ ì¡°íšŒ",
                            "GET",
                            `/api/scores/${loggedInMemberId}`
                        );
                    }

                    // 15. ì ìˆ˜ ìˆ˜ì •
                    log("\n=== [15] ì ìˆ˜ ìˆ˜ì • ===", "info");
                    await testAPI(15, "ì ìˆ˜ ìˆ˜ì •", "PUT", "/api/scores", {
                        score: 200,
                    });

                    // 16. ë¬¸ì œ ì „ì²´ ì¡°íšŒ (INFOENGINEERING)
                    log(
                        "\n=== [16] ë¬¸ì œ ì „ì²´ ì¡°íšŒ (INFOENGINEERING) ===",
                        "info"
                    );
                    await testAPI(
                        16,
                        "ë¬¸ì œ ì¡°íšŒ",
                        "GET",
                        "/api/problem?limit=4&category=INFOENGINEERING"
                    );

                    // 17. ë¬¸ì œ ì „ì²´ ì¡°íšŒ (SQLD)
                    log("\n=== [17] ë¬¸ì œ ì „ì²´ ì¡°íšŒ (SQLD) ===", "info");
                    await testAPI(
                        17,
                        "ë¬¸ì œ ì¡°íšŒ (SQLD)",
                        "GET",
                        "/api/problem?limit=4&category=SQLD"
                    );

                    // 18. ì˜¤ë‹µë…¸íŠ¸ ì¶”ê°€ ë° ì¡°íšŒ
                    log("\n=== [18] ì˜¤ë‹µë…¸íŠ¸ ì¶”ê°€ ë° ì¡°íšŒ ===", "info");
                    const addNoteResult1 = await testAPI(
                        18,
                        "ì˜¤ë‹µë…¸íŠ¸ ì¶”ê°€ (ê¸°ë³¸ ë¬¸ì œ)",
                        "POST",
                        "/api/incorrect-note",
                        {
                            problemId: 1,
                            userProblemId: null,
                            isUserProblem: false,
                        }
                    );
                    if (
                        addNoteResult1.success &&
                        addNoteResult1.response?.data
                    ) {
                        incorrectNoteId = addNoteResult1.response.data;
                    }

                    if (userProblemIds.length > 0) {
                        await testAPI(
                            18,
                            "ì˜¤ë‹µë…¸íŠ¸ ì¶”ê°€ (ìœ ì €ì œì‘ë¬¸ì œ)",
                            "POST",
                            "/api/incorrect-note",
                            {
                                problemId: null,
                                userProblemId: userProblemIds[0],
                                isUserProblem: true,
                            }
                        );
                    }

                    await testAPI(
                        18,
                        "ì˜¤ë‹µë…¸íŠ¸ ì¡°íšŒ",
                        "GET",
                        "/api/incorrect-note"
                    );

                    // 19. ì˜¤ë‹µë…¸íŠ¸ ì‚­ì œ
                    log("\n=== [19] ì˜¤ë‹µë…¸íŠ¸ ì‚­ì œ ===", "info");
                    if (incorrectNoteId) {
                        await testAPI(
                            19,
                            "ì˜¤ë‹µë…¸íŠ¸ ì‚­ì œ",
                            "DELETE",
                            `/api/incorrect-note/${incorrectNoteId}`
                        );
                    }

                    // 20. í€´ì¦ˆë°© ëª©ë¡ ì¡°íšŒ
                    log("\n=== [20] í€´ì¦ˆë°© ëª©ë¡ ì¡°íšŒ ===", "info");
                    await testAPI(
                        20,
                        "í€´ì¦ˆë°© ëª©ë¡ ì¡°íšŒ",
                        "GET",
                        "/api/quiz-room"
                    );

                    // 21. í€´ì¦ˆë°© ë©¤ë²„ ì¡°íšŒ
                    log("\n=== [21] í€´ì¦ˆë°© ë©¤ë²„ ì¡°íšŒ ===", "info");
                    const roomListResult = await testAPI(
                        21,
                        "í€´ì¦ˆë°© ëª©ë¡ ì¡°íšŒ",
                        "GET",
                        "/api/quiz-room"
                    );
                    if (
                        roomListResult.success &&
                        roomListResult.response?.data?.length > 0
                    ) {
                        const firstRoomId =
                            roomListResult.response.data[0].roomId;
                        await testAPI(
                            21,
                            "í€´ì¦ˆë°© ë©¤ë²„ ì¡°íšŒ",
                            "GET",
                            `/api/quiz-room/${firstRoomId}/member`
                        );
                    }

                    // 22. í€´ì¦ˆë°© ìƒì„±
                    log("\n=== [22] í€´ì¦ˆë°© ìƒì„± ===", "info");
                    if (loggedInMemberId) {
                        const createRoomResult = await testAPI(
                            22,
                            "í€´ì¦ˆë°© ìƒì„±",
                            "POST",
                            `/api/quiz-room/create/${loggedInMemberId}`
                        );
                        if (
                            createRoomResult.success &&
                            createRoomResult.response?.data
                        ) {
                            quizRoomId = createRoomResult.response.data;
                            log(`ìƒì„±ëœ í€´ì¦ˆë°© ID: ${quizRoomId}`, "info");
                        }
                    }

                    // 24. í€´ì¦ˆë°© ì‚­ì œ
                    log("\n=== [24] í€´ì¦ˆë°© ì‚­ì œ ===", "info");
                    if (quizRoomId) {
                        await testAPI(
                            24,
                            "í€´ì¦ˆë°© ì‚­ì œ",
                            "DELETE",
                            `/api/quiz-room/${quizRoomId}`
                        );
                    }

                    // ê²°ê³¼ ìš”ì•½
                    log("\n=== í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½ ===", "info");
                    const total = testResults.length;
                    const success = testResults.filter((r) => r.success).length;
                    const failed = testResults.filter((r) => !r.success).length;
                    const successRate = ((success / total) * 100).toFixed(1);

                    log(`\nì´ í…ŒìŠ¤íŠ¸: ${total}ê°œ`, "info");
                    log(`âœ… ì„±ê³µ: ${success}ê°œ`, "info");
                    log(`âŒ ì‹¤íŒ¨: ${failed}ê°œ`, "info");
                    log(`ì„±ê³µë¥ : ${successRate}%`, "info");

                    log("\nâœ… ì„±ê³µí•œ í…ŒìŠ¤íŠ¸:", "info");
                    testResults
                        .filter((r) => r.success)
                        .forEach((r) => {
                            log(
                                `  âœ… [${r.step}] ${r.name} - ${r.method} ${r.url} (${r.status})`,
                                "info"
                            );
                        });

                    log("\nâŒ ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸:", "info");
                    const failedResults = testResults.filter((r) => !r.success);
                    if (failedResults.length === 0) {
                        log("  ì—†ìŒ - ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí–ˆìŠµë‹ˆë‹¤! ğŸ‰", "info");
                    } else {
                        failedResults.forEach((r) => {
                            log(
                                `  âŒ [${r.step}] ${r.name} - ${r.method} ${
                                    r.url
                                } (${r.status || "N/A"})`,
                                "error"
                            );
                        });
                    }

                    // ê²°ê³¼ë¥¼ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                    downloadResults();

                    updateStatus(
                        `í…ŒìŠ¤íŠ¸ ì™„ë£Œ! ì„±ê³µë¥ : ${successRate}%`,
                        "success"
                    );
                } catch (error) {
                    log(`í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, "error");
                    updateStatus("í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨", "error");
                } finally {
                    isTestRunning = false;
                    document.getElementById("startTest").disabled = false;
                    document.getElementById("stopTest").disabled = true;
                }
            }

            function stopTest() {
                isTestRunning = false;
                document.getElementById("startTest").disabled = false;
                document.getElementById("stopTest").disabled = true;
                updateStatus("í…ŒìŠ¤íŠ¸ ì¤‘ì§€ë¨", "pending");
                log("í…ŒìŠ¤íŠ¸ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
            }

            function downloadResults() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, "0");
                const day = String(now.getDate()).padStart(2, "0");
                const hours = String(now.getHours()).padStart(2, "0");
                const minutes = String(now.getMinutes()).padStart(2, "0");
                const timestamp = `${year}${month}${day}${hours}${minutes}`;
                const filename = `testResult${timestamp}.md`;

                let report = "# í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ê²°ê³¼ ë³´ê³ ì„œ\n\n";
                report += `**í…ŒìŠ¤íŠ¸ ì¼ì‹œ**: ${year}-${month}-${day} ${hours}:${minutes}\n\n`;

                const total = testResults.length;
                const success = testResults.filter((r) => r.success).length;
                const failed = testResults.filter((r) => !r.success).length;
                const successRate = ((success / total) * 100).toFixed(1);

                report += `**ì´ í…ŒìŠ¤íŠ¸**: ${total}ê°œ\n`;
                report += `**âœ… ì„±ê³µ**: ${success}ê°œ\n`;
                report += `**âŒ ì‹¤íŒ¨**: ${failed}ê°œ\n`;
                report += `**ì„±ê³µë¥ **: ${successRate}%\n\n`;
                report += "---\n\n";

                report += "## âœ… ì„±ê³µí•œ í…ŒìŠ¤íŠ¸\n\n";
                testResults
                    .filter((r) => r.success)
                    .forEach((r) => {
                        report += `### [${r.step}] ${r.name}\n`;
                        report += `- **Method**: ${r.method}\n`;
                        report += `- **URL**: ${r.url}\n`;
                        report += `- **Status**: ${r.status}\n`;
                        report += `- **ì‘ë‹µ**: \`\`\`json\n${JSON.stringify(
                            r.response,
                            null,
                            2
                        )}\n\`\`\`\n\n`;
                    });

                report += "---\n\n";
                report += "## âŒ ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸\n\n";
                const failedResults = testResults.filter((r) => !r.success);
                if (failedResults.length === 0) {
                    report += "ì—†ìŒ - ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí–ˆìŠµë‹ˆë‹¤! ğŸ‰\n\n";
                } else {
                    failedResults.forEach((r) => {
                        report += `### [${r.step}] ${r.name}\n`;
                        report += `- **Method**: ${r.method}\n`;
                        report += `- **URL**: ${r.url}\n`;
                        report += `- **Status**: ${r.status || "N/A"}\n`;
                        report += `- **ì—ëŸ¬**: \`\`\`json\n${JSON.stringify(
                            r.error,
                            null,
                            2
                        )}\n\`\`\`\n\n`;
                    });
                }

                report += "---\n\n";
                report += "## ğŸ“‹ ìƒì„¸ ê²°ê³¼\n\n";
                testResults.forEach((r) => {
                    const icon = r.success ? "âœ…" : "âŒ";
                    report += `### [${r.step}] ${icon} ${r.name}\n\n`;
                    report += `- **Method**: \`${r.method}\`\n`;
                    report += `- **URL**: \`${r.url}\`\n`;
                    report += `- **Status**: ${r.status || "N/A"}\n`;
                    if (r.response && r.success) {
                        report += `- **ì‘ë‹µ**: \`\`\`json\n${JSON.stringify(
                            r.response,
                            null,
                            2
                        )}\n\`\`\`\n`;
                    }
                    if (r.error && !r.success) {
                        report += `- **ì—ëŸ¬**: \`\`\`json\n${JSON.stringify(
                            r.error,
                            null,
                            2
                        )}\n\`\`\`\n`;
                    }
                    report += "\n";
                });

                const blob = new Blob([report], { type: "text/markdown" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                log(`\nğŸ“„ í…ŒìŠ¤íŠ¸ ê²°ê³¼ íŒŒì¼ ë‹¤ìš´ë¡œë“œ: ${filename}`, "info");
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
            window.addEventListener("load", () => {
                log(
                    "í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ. í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.",
                    "info"
                );
                log(
                    "ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ ì—´ì–´ì„œ ìƒì„¸í•œ JSON ì‘ë‹µì„ í™•ì¸í•˜ì„¸ìš”.",
                    "info"
                );
                updateLoginStatus();
            });
        </script>
    </body>
</html>
